# NeoCode tmux Configuration
# Enhanced tmux setup for VSCode-like experience

# Set prefix key to Ctrl-a (like screen)
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Enable mouse support
set -g mouse on

# Disable right-click paste (prevents accidental pastes)
unbind-key -T root MouseDown3Pane
# Optional: Bind right-click to open context menu instead
# bind-key -T root MouseDown3Pane display-menu -T "#[align=centre]#{pane_index} (#{pane_id})" -x M -y M \
#   "#{?mouse_word,Search For #[underscore]#{=/9/...:mouse_word},}" C-r { copy-mode -t=; send -Xt= search-backward "#{q:mouse_word}" } \
#   "#{?mouse_word,Type #[underscore]#{=/9/...:mouse_word},}" C-y { send-keys -l -- "#{q:mouse_word}" } \
#   "#{?mouse_word,Copy #[underscore]#{=/9/...:mouse_word},}" c { set-buffer -- "#{q:mouse_word}" } \
#   "#{?mouse_line,Copy Line,}" l { set-buffer -- "#{q:mouse_line}" } \
#   "Horizontal Split" h { split-window -h } \
#   "Vertical Split" v { split-window -v }  \
#   Kill X { kill-pane }

# Start windows and panes at 1
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Enable 24-bit color
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Increase scrollback buffer
set -g history-limit 10000

# Enable clipboard
set -g set-clipboard on

# Status bar configuration
set -g status-position bottom
set -g status-justify left
set -g status-style 'bg=#1e1e2e,fg=#cdd6f4'
set -g status-left ''
set -g status-right '#[fg=#f38ba8,bg=#1e1e2e] %Y-%m-%d #[fg=#89b4fa,bg=#1e1e2e] %H:%M:%S '
set -g status-right-length 50
set -g status-left-length 20

# Window status
setw -g window-status-current-style 'fg=#1e1e2e,bg=#89b4fa,bold'
setw -g window-status-current-format ' #I#[fg=#1e1e2e]:#[fg=#1e1e2e]#W#[fg=#f9e2af]#F '
setw -g window-status-style 'fg=#cdd6f4,bg=#313244'
setw -g window-status-format ' #I#[fg=#cdd6f4]:#[fg=#cdd6f4]#W#[fg=#cdd6f4]#F '

# Pane borders
set -g pane-border-style 'fg=#313244'
set -g pane-active-border-style 'fg=#89b4fa'

# Message style
set -g message-style 'fg=#1e1e2e,bg=#f38ba8,bold'

# Key bindings
# Pane splitting (more intuitive)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind '"' split-window -v -c "#{pane_current_path}"  # Vertical split
bind % split-window -h -c "#{pane_current_path}"   # Horizontal split

# Smart pane switching with awareness of Vim splits (enhanced pattern)
# See: https://github.com/christoomey/vim-tmux-navigator
vim_pattern='(\S+/)?g?\.?(view|l?n?vim?x?|fzf)(diff)?(-wrapped)?'
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +${vim_pattern}$'"
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'
tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\'  'select-pane -l'"
if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\'  'select-pane -l'"

bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R
bind-key -T copy-mode-vi 'C-\' select-pane -l

# Pane navigation (vim-like + arrow keys) with prefix
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Also allow Alt+arrow for pane navigation (no prefix needed)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R  
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Pane resizing (with repeat)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Ctrl+Arrow for resizing (no prefix needed)
bind -n C-S-Left resize-pane -L 2
bind -n C-S-Right resize-pane -R 2
bind -n C-S-Up resize-pane -U 2
bind -n C-S-Down resize-pane -D 2

# Window navigation
bind -n C-Left previous-window
bind -n C-Right next-window

# Quick pane layouts
bind Space next-layout
bind = select-layout tiled

# Reload config
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Copy mode vi-style
setw -g mode-keys vi
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'xclip -in -selection clipboard'

# Session management
bind S new-session
bind K kill-session

# Enhanced VSCode-like key bindings
bind C-n new-window -n "NeoCode" "nvim"
bind C-t new-window -n "Terminal"
bind C-e split-window -h -c "#{pane_current_path}" # VSCode Ctrl+Shift+E equivalent
bind C-p command-prompt "split-window -h -c '#{pane_current_path}' 'find . -name \"*%%*\"'" # Quick file finder

# VSCode-inspired panel toggles
bind C-j split-window -v -c "#{pane_current_path}" \; resize-pane -D 10 # Terminal panel
bind C-b run-shell "tmux list-panes -F '#{pane_current_command}' | grep -q nvim && tmux send-keys C-b || tmux select-pane -L" # Sidebar toggle

# Enhanced window management (VSCode tabs)
bind -n C-PageUp previous-window
bind -n C-PageDown next-window
bind -n C-S-PageUp swap-window -t -1\; select-window -t -1
bind -n C-S-PageDown swap-window -t +1\; select-window -t +1